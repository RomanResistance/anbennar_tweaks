the_fallen_invasion_army = {
	H94 = { infantry = PREV }
	H94 = { infantry = PREV }
	H94 = { infantry = PREV }
	H94 = { infantry = PREV }
	H94 = { infantry = PREV }
	H94 = { infantry = PREV }
	H94 = { infantry = PREV }
	H94 = { infantry = PREV }
	H94 = { infantry = PREV }
	H94 = { infantry = PREV }
	H94 = { infantry = PREV }
	H94 = { infantry = PREV }
	H94 = { infantry = PREV }
	H94 = { infantry = PREV }
	H94 = { infantry = PREV }
	H94 = { infantry = PREV }
	H94 = { infantry = PREV }
	H94 = { infantry = PREV }
	H94 = { infantry = PREV }
	H94 = { infantry = PREV }
	H94 = { artillery = PREV }
	H94 = { artillery = PREV }
	H94 = { artillery = PREV }
	H94 = { artillery = PREV }
	H94 = { artillery = PREV }
	H94 = { artillery = PREV }
	H94 = { artillery = PREV }
	H94 = { artillery = PREV }
	H94 = { artillery = PREV }
	H94 = { artillery = PREV }
}

the_fallen_invasion_infiltrator = {
	H94 = { infantry = PREV }
	H94 = { infantry = PREV }
	H94 = { infantry = PREV }
	H94 = { infantry = PREV }
	H94 = { infantry = PREV }
	H94 = { infantry = PREV }
	H94 = { infantry = PREV }
	H94 = { infantry = PREV }
	H94 = { infantry = PREV }
	H94 = { infantry = PREV }
}


define_hold_to_repair = {
	random_owned_province = {
		limit = { OR = { has_province_modifier = ruined_hold has_province_modifier = partially_ruined_hold has_province_modifier = damaged_hold } NOT = { has_construction = building has_province_flag = repair_@ROOT } is_city = yes is_core = ROOT }
		set_province_flag = option_repair_1_@ROOT
		set_province_flag = repair_@ROOT
		save_event_target_as = repair1
		setup_restoration_speed = yes
	}
	random_owned_province = {
		limit = { OR = { has_province_modifier = ruined_hold has_province_modifier = partially_ruined_hold has_province_modifier = damaged_hold } NOT = { has_construction = building has_province_flag = repair_@ROOT } is_city = yes is_core = ROOT }
		set_province_flag = option_repair_2_@ROOT
		set_province_flag = repair_@ROOT
		save_event_target_as = repair2
		setup_restoration_speed = yes
	}
	random_owned_province = {
		limit = { OR = { has_province_modifier = ruined_hold has_province_modifier = partially_ruined_hold has_province_modifier = damaged_hold } NOT = { has_construction = building has_province_flag = repair_@ROOT } is_city = yes is_core = ROOT }
		set_province_flag = option_repair_3_@ROOT
		set_province_flag = repair_@ROOT
		save_event_target_as = repair3
		setup_restoration_speed = yes
	}
	random_owned_province = {
		limit = { OR = { has_province_modifier = ruined_hold has_province_modifier = partially_ruined_hold has_province_modifier = damaged_hold } NOT = { has_construction = building has_province_flag = repair_@ROOT } is_city = yes is_core = ROOT }
		set_province_flag = option_repair_4_@ROOT
		set_province_flag = repair_@ROOT
		save_event_target_as = repair4
		setup_restoration_speed = yes
	}
	random_owned_province = {
		limit = { OR = { has_province_modifier = ruined_hold has_province_modifier = partially_ruined_hold has_province_modifier = damaged_hold } NOT = { has_construction = building has_province_flag = repair_@ROOT } is_city = yes is_core = ROOT }
		set_province_flag = option_repair_5_@ROOT
		set_province_flag = repair_@ROOT
		save_event_target_as = repair5
		setup_restoration_speed = yes
	}
	random_owned_province = {
		limit = { OR = { has_province_modifier = ruined_hold has_province_modifier = partially_ruined_hold has_province_modifier = damaged_hold } NOT = { has_construction = building has_province_flag = repair_@ROOT } is_city = yes is_core = ROOT }
		set_province_flag = option_repair_6_@ROOT
		set_province_flag = repair_@ROOT
		save_event_target_as = repair6
		setup_restoration_speed = yes
	}
}

setup_restoration_speed = {
	hidden_effect = {
		set_variable = { globalCost = 0 }
		set_variable = { globalTime = 0 }
		set_variable = { localCost = 0 }
		set_variable = { localTime = 0 }
		set_variable = { testCost = 0 }
		set_variable = { testTime = 0 }
		set_variable = { Cost = 0 }
		set_variable = { Time = 0 }
		trigger_switch = {
			on_trigger = development
			
			100 = { set_variable = { speed = 35 } }
			97 = { set_variable = { speed = 34 } }
			94 = { set_variable = { speed = 33 } }
			91 = { set_variable = { speed = 32 } }
			88 = { set_variable = { speed = 31 } }
			85 = { set_variable = { speed = 30 } }
			82 = { set_variable = { speed = 29 } }
			79 = { set_variable = { speed = 28 } }
			76 = { set_variable = { speed = 27 } }
			73 = { set_variable = { speed = 26 } }
			70 = { set_variable = { speed = 25 } }
			67 = { set_variable = { speed = 24 } }
			64 = { set_variable = { speed = 23 } }
			61 = { set_variable = { speed = 22 } }
			58 = { set_variable = { speed = 21 } }
			55 = { set_variable = { speed = 20 } }
			52 = { set_variable = { speed = 19 } }
			49 = { set_variable = { speed = 18 } }
			46 = { set_variable = { speed = 17 } }
			43 = { set_variable = { speed = 16 } }
			40 = { set_variable = { speed = 15 } }
			37 = { set_variable = { speed = 14 } }
			34 = { set_variable = { speed = 13 } }
			31 = { set_variable = { speed = 12 } }
			28 = { set_variable = { speed = 11 } }
			25 = { set_variable = { speed = 10 } }
			22 = { set_variable = { speed = 9 } }
			19 = { set_variable = { speed = 8 } }
			16 = { set_variable = { speed = 7 } }
			13 = { set_variable = { speed = 6 } }
			10 = { set_variable = { speed = 5 } }
			7 = { set_variable = { speed = 4 } }
			4 = { set_variable = { speed = 3 } }
			3 = { set_variable = { speed = 2 } }
		}
		if = {
			limit = { has_coexisting_dwarven_pop_trigger = yes }
			multiply_variable = { speed = 0.9 }
		}
		if = {
			limit = { has_integrated_dwarven_pop_trigger = yes }
			multiply_variable = { speed = 0.8 }
		}
		if = {
			limit = { is_capital = yes }
			multiply_variable = { speed = 0.5 }
		}
		if = {
			limit = { owner = { NOT = { num_of_cities = 2 } } }
			multiply_variable = { speed = 0.2 }
		}
		if = {
			limit = { has_province_modifier = ruined_hold }
			multiply_variable = { speed = 1.2 }
		}
		if = {
			limit = { has_province_modifier = partially_ruined_hold }
			multiply_variable = { speed = 0.9 }
		}
		if = {
			limit = { has_province_modifier = damaged_hold }
			multiply_variable = { speed = 0.8 }
		}
		if = {
			limit = { owner = { has_country_modifier = how_to_dig } }
			multiply_variable = { speed = 0.95 }
		}
		if = {
			limit = { owner = { has_country_flag = remnant_dig } }
			multiply_variable = { speed = 0.95 }
		}
		if = {
			limit = { owner = { NOT = { has_country_modifier = dwarven_administration } } }
			multiply_variable = { speed = 1.5 }
		}
		if = {
			limit = { owner = { has_age_ability = ab_dwarven_reclamation } }
			multiply_variable = { speed = 0.8 }
		}
	}
	if = {
		limit = { check_variable = { speed = 30 } }
		set_variable = { speed = 30 }
	}
	if = {
		limit = { NOT = { check_variable = { speed = 5 } } }
		set_variable = { speed = 5 }
	}
	multiply_variable = { speed = 0.001 }
	multiply_variable = { speed = 1000 }#Final Cost in Ducats
	export_to_variable = {
		which = globalCost
		value = modifier:build_cost
		who = PREV
	}
	export_to_variable = {
		which = globalTime
		value = modifier:build_time
		who = PREV
	}
	export_to_variable = {
		which = localCost
		value = modifier:local_build_cost
	}
	export_to_variable = {
		which = localTime
		value = modifier:local_build_time
	}
	change_variable = {
		which = localCost
		which = globalCost
	}
	change_variable = {
		which = localTime
		which = globalTime
	}
	
	change_variable = { Cost = 1 }
	change_variable = { Time = 1 }
	change_variable = { which = Cost which = localCost }
	change_variable = { which = Time which = localTime }
	
	set_variable = { which = finalCost which = speed }
	multiply_variable = { which = finalCost which = finalCost }
	divide_variable = { finalCost = 10 }
	divide_variable = { finalCost = 2 }
	multiply_variable = { finalCost = 100 } #speedï¿½/10/2x100
	multiply_variable = { which = finalCost which = Cost }
	multiply_variable = { finalCost = 0.001 }
	multiply_variable = { finalCost = 1000 }#Final Cost in Ducats
	
	set_variable = { which = finalTime which = speed }
	multiply_variable = { which = finalTime which = Time } #Final Time in Years
}

repair_hold = {
	# custom_tooltip = see_speed_value
	hidden_effect = { cancel_construction = yes }
	if = {
		limit = { has_province_modifier = ruined_hold }
		trigger_switch = {
			on_trigger = development
			
			100 = { owner = { add_mil_power = -500 add_dip_power = -500 add_adm_power = -500 } }
			90 = { owner = { add_mil_power = -450 add_dip_power = -450 add_adm_power = -450 } }
			80 = { owner = { add_mil_power = -400 add_dip_power = -400 add_adm_power = -400 } }
			70 = { owner = { add_mil_power = -350 add_dip_power = -350 add_adm_power = -350 } }
			60 = { owner = { add_mil_power = -300 add_dip_power = -300 add_adm_power = -300 } }
			50 = { owner = { add_mil_power = -250 add_dip_power = -250 add_adm_power = -250 } }
			40 = { owner = { add_mil_power = -200 add_dip_power = -200 add_adm_power = -200 } }
			30 = { owner = { add_mil_power = -150 add_dip_power = -150 add_adm_power = -150 } }
			20 = { owner = { add_mil_power = -100 add_dip_power = -100 add_adm_power = -100 } }
			10 = { owner = { add_mil_power = -50 add_dip_power = -50 add_adm_power = -50 } }
			3 = { owner = { add_mil_power = -50 add_dip_power = -50 add_adm_power = -50 } }
		}
	}
	else_if = {
		limit = { has_province_modifier = partially_ruined_hold }
		trigger_switch = {
			on_trigger = development
			
			100 = { owner = { add_mil_power = -400 add_dip_power = -400 add_adm_power = -400 } }
			90 = { owner = { add_mil_power = -350 add_dip_power = -350 add_adm_power = -350 } }
			80 = { owner = { add_mil_power = -325 add_dip_power = -325 add_adm_power = -325 } }
			70 = { owner = { add_mil_power = -300 add_dip_power = -300 add_adm_power = -300 } }
			60 = { owner = { add_mil_power = -250 add_dip_power = -250 add_adm_power = -250 } }
			50 = { owner = { add_mil_power = -200 add_dip_power = -200 add_adm_power = -200 } }
			40 = { owner = { add_mil_power = -175 add_dip_power = -175 add_adm_power = -175 } }
			30 = { owner = { add_mil_power = -150 add_dip_power = -150 add_adm_power = -150 } }
			20 = { owner = { add_mil_power = -100 add_dip_power = -100 add_adm_power = -100 } }
			10 = { owner = { add_mil_power = -50 add_dip_power = -50 add_adm_power = -50 } }
			3 = { owner = { add_mil_power = -50 add_dip_power = -50 add_adm_power = -50 } }
		}
	}
	else_if = {
		limit = { has_province_modifier = damaged_hold }
		trigger_switch = {
			on_trigger = development
			
			100 = { owner = { add_mil_power = -300 add_dip_power = -300 add_adm_power = -300 } }
			90 = { owner = { add_mil_power = -275 add_dip_power = -275 add_adm_power = -275 } }
			80 = { owner = { add_mil_power = -250 add_dip_power = -250 add_adm_power = -250 } }
			70 = { owner = { add_mil_power = -225 add_dip_power = -225 add_adm_power = -225 } }
			60 = { owner = { add_mil_power = -175 add_dip_power = -175 add_adm_power = -175 } }
			50 = { owner = { add_mil_power = -125 add_dip_power = -125 add_adm_power = -125 } }
			40 = { owner = { add_mil_power = -100 add_dip_power = -100 add_adm_power = -100 } }
			30 = { owner = { add_mil_power = -75 add_dip_power = -75 add_adm_power = -75 } }
			20 = { owner = { add_mil_power = -50 add_dip_power = -50 add_adm_power = -50 } }
			10 = { owner = { add_mil_power = -50 add_dip_power = -50 add_adm_power = -50 } }
			3 = { owner = { add_mil_power = -50 add_dip_power = -50 add_adm_power = -50 } }
		}
	}
	# custom_tooltip = see_speed_value
	custom_tooltip = cost_hold_restoration_tooltip
	hidden_effect = {
		if = { limit = { check_variable = { speed = 35 } } add_building_construction = { building = restoring_hold speed = 35 cost = 6125 } }
		else_if = { limit = { check_variable = { speed = 34 } } add_building_construction = { building = restoring_hold speed = 34 cost = 5780 } }
		else_if = { limit = { check_variable = { speed = 33 } } add_building_construction = { building = restoring_hold speed = 33 cost = 5445 } }
		else_if = { limit = { check_variable = { speed = 32 } } add_building_construction = { building = restoring_hold speed = 32 cost = 5120 } }
		else_if = { limit = { check_variable = { speed = 31 } } add_building_construction = { building = restoring_hold speed = 31 cost = 4805 } }
		else_if = { limit = { check_variable = { speed = 30 } } add_building_construction = { building = restoring_hold speed = 30 cost = 4500 } }
		else_if = { limit = { check_variable = { speed = 29 } } add_building_construction = { building = restoring_hold speed = 29 cost = 4205 } }
		else_if = { limit = { check_variable = { speed = 28 } } add_building_construction = { building = restoring_hold speed = 28 cost = 3920 } }
		else_if = { limit = { check_variable = { speed = 27 } } add_building_construction = { building = restoring_hold speed = 27 cost = 3645 } }
		else_if = { limit = { check_variable = { speed = 26 } } add_building_construction = { building = restoring_hold speed = 26 cost = 3380 } }
		else_if = { limit = { check_variable = { speed = 25 } } add_building_construction = { building = restoring_hold speed = 25 cost = 3125 } }
		else_if = { limit = { check_variable = { speed = 24 } } add_building_construction = { building = restoring_hold speed = 24 cost = 2880 } }
		else_if = { limit = { check_variable = { speed = 23 } } add_building_construction = { building = restoring_hold speed = 23 cost = 2645 } }
		else_if = { limit = { check_variable = { speed = 22 } } add_building_construction = { building = restoring_hold speed = 22 cost = 2420 } }
		else_if = { limit = { check_variable = { speed = 21 } } add_building_construction = { building = restoring_hold speed = 21 cost = 2205 } }
		else_if = { limit = { check_variable = { speed = 20 } } add_building_construction = { building = restoring_hold speed = 20 cost = 2000 } }
		else_if = { limit = { check_variable = { speed = 19 } } add_building_construction = { building = restoring_hold speed = 19 cost = 1805 } }
		else_if = { limit = { check_variable = { speed = 18 } } add_building_construction = { building = restoring_hold speed = 18 cost = 1620 } }
		else_if = { limit = { check_variable = { speed = 17 } } add_building_construction = { building = restoring_hold speed = 17 cost = 1445 } }
		else_if = { limit = { check_variable = { speed = 16 } } add_building_construction = { building = restoring_hold speed = 16 cost = 1280 } }
		else_if = { limit = { check_variable = { speed = 15 } } add_building_construction = { building = restoring_hold speed = 15 cost = 1125 } }
		else_if = { limit = { check_variable = { speed = 14 } } add_building_construction = { building = restoring_hold speed = 14 cost = 980 } }
		else_if = { limit = { check_variable = { speed = 13 } } add_building_construction = { building = restoring_hold speed = 13 cost = 845 } }
		else_if = { limit = { check_variable = { speed = 12 } } add_building_construction = { building = restoring_hold speed = 12 cost = 720 } }
		else_if = { limit = { check_variable = { speed = 11 } } add_building_construction = { building = restoring_hold speed = 11 cost = 605 } }
		else_if = { limit = { check_variable = { speed = 10 } } add_building_construction = { building = restoring_hold speed = 10 cost = 500 } }
		else_if = { limit = { check_variable = { speed = 9 } } add_building_construction = { building = restoring_hold speed = 9 cost = 405 } }
		else_if = { limit = { check_variable = { speed = 8 } } add_building_construction = { building = restoring_hold speed = 8 cost = 320 } }
		else_if = { limit = { check_variable = { speed = 7 } } add_building_construction = { building = restoring_hold speed = 7 cost = 245 } }
		else_if = { limit = { check_variable = { speed = 6 } } add_building_construction = { building = restoring_hold speed = 6 cost = 180 } }
		else = { limit = { check_variable = { speed = 5 } } add_building_construction = { building = restoring_hold speed = 5 cost = 125 } }
		set_province_flag = being_restored
	}
}

repair_hold_ai = { #They're so dumb it's insane
	set_province_flag = being_restored
	cancel_construction = yes
	trigger_switch = {
		on_trigger = development
		
		120 = { add_building_construction = { building = restoring_hold speed = 23 cost = 500 } }
		115 = { add_building_construction = { building = restoring_hold speed = 22 cost = 400 } }
		110 = { add_building_construction = { building = restoring_hold speed = 21 cost = 400 } }
		105 = { add_building_construction = { building = restoring_hold speed = 20 cost = 400 } }
		100 = { add_building_construction = { building = restoring_hold speed = 19 cost = 400 } }
		95 = { add_building_construction = { building = restoring_hold speed = 18 cost = 400 } }
		90 = { add_building_construction = { building = restoring_hold speed = 17 cost = 300 } }
		85 = { add_building_construction = { building = restoring_hold speed = 16 cost = 300 } }
		80 = { add_building_construction = { building = restoring_hold speed = 15 cost = 300 } }
		75 = { add_building_construction = { building = restoring_hold speed = 14 cost = 300 } }
		70 = { add_building_construction = { building = restoring_hold speed = 13 cost = 300 } }
		65 = { add_building_construction = { building = restoring_hold speed = 12 cost = 200 } }
		60 = { add_building_construction = { building = restoring_hold speed = 11 cost = 200 } }
		55 = { add_building_construction = { building = restoring_hold speed = 10 cost = 200 } }
		50 = { add_building_construction = { building = restoring_hold speed = 9 cost = 200 } }
		45 = { add_building_construction = { building = restoring_hold speed = 8 cost = 200 } }
		40 = { add_building_construction = { building = restoring_hold speed = 7 cost = 100 } }
		35 = { add_building_construction = { building = restoring_hold speed = 6 cost = 100 } }
		20 = { add_building_construction = { building = restoring_hold speed = 5 cost = 100 } }
		15 = { add_building_construction = { building = restoring_hold speed = 4 cost = 100 } }
		10 = { add_building_construction = { building = restoring_hold speed = 3 cost = 100 } }
		3 = { add_building_construction = { building = restoring_hold speed = 2 cost = 100 } }
		1 = { add_building_construction = { building = restoring_hold speed = 1 cost = 100 } }
	}
}

restored_hold = {
	remove_province_modifier = damaged_hold
	remove_province_modifier = partially_ruined_hold
	hidden_effect = { clr_province_flag = being_restored }
	if = {
		limit = { has_province_modifier = ruined_hold }
		trigger_switch = {
			on_trigger = development
			100 = { add_permanent_province_modifier = { name = dig_8 duration = -1 } }
			90 = { add_permanent_province_modifier = { name = dig_7 duration = -1 } }
			80 = { add_permanent_province_modifier = { name = dig_6 duration = -1 } }
			70 = { add_permanent_province_modifier = { name = dig_5 duration = -1 } }
			60 = { add_permanent_province_modifier = { name = dig_4 duration = -1 } }
			50 = { add_permanent_province_modifier = { name = dig_3 duration = -1 } }
			40 = { add_permanent_province_modifier = { name = dig_2 duration = -1 } }
			3 = { add_permanent_province_modifier = { name = dig_1 duration = -1 } }
		}
		remove_province_modifier = ruined_hold
	}
}

define_hold_to_clear = {
	random_owned_province = {
		limit = { has_province_modifier = infested_hold is_city = yes NOT = { has_province_flag = infested_@ROOT } }
		set_province_flag = option_infested_1_@ROOT
		set_province_flag = infested_@ROOT
		save_event_target_as = infested1
	}
	random_owned_province = {
		limit = { has_province_modifier = infested_hold is_city = yes NOT = { has_province_flag = infested_@ROOT } }
		set_province_flag = option_infested_2_@ROOT
		set_province_flag = infested_@ROOT
		save_event_target_as = infested2
	}
	random_owned_province = {
		limit = { has_province_modifier = infested_hold is_city = yes NOT = { has_province_flag = infested_@ROOT } }
		set_province_flag = option_infested_3_@ROOT
		set_province_flag = infested_@ROOT
		save_event_target_as = infested3
	}
	random_owned_province = {
		limit = { has_province_modifier = infested_hold is_city = yes NOT = { has_province_flag = infested_@ROOT } }
		set_province_flag = option_infested_4_@ROOT
		set_province_flag = infested_@ROOT
		save_event_target_as = infested4
	}
}

infested_hold_clearing = {
	trigger_switch = {
		on_trigger = development
		
		35 = { spawn_rebels = { type = cave_orc_rebel culture = black_orc size = 1 } spawn_rebels = { type = cave_orc_rebel culture = black_orc size = 1 } spawn_rebels = { type = cave_orc_rebel culture = black_orc size = 1 } }
		20 = { spawn_rebels = { type = cave_orc_rebel culture = black_orc size = 1 } spawn_rebels = { type = cave_orc_rebel culture = black_orc size = 1 } }
		3 = { spawn_rebels = { type = cave_orc_rebel culture = black_orc size = 1 } }
	}
	remove_province_modifier = infested_hold
	add_permanent_province_modifier = {
		name = ruined_hold
		duration = -1
	}
	hidden_effect = {
		owner = {
			every_owned_province = {
				limit = { has_province_flag = infested_@ROOT }
				clr_province_flag = infested_@ROOT
				clr_province_flag = option_infested_1_@ROOT
				clr_province_flag = option_infested_2_@ROOT
				clr_province_flag = option_infested_3_@ROOT
				clr_province_flag = option_infested_4_@ROOT
			}
			clr_country_flag = open_infested_hold_menu
		}
	}
}
setup_digging_deeper_capital = {
	hidden_effect = {
		trigger_switch = {
			on_trigger = has_province_modifier
			
			dig_1 = { set_variable = { speed = 10 } }
			dig_2 = { set_variable = { speed = 20 } }
			dig_3 = { set_variable = { speed = 25 } }
			dig_4 = { set_variable = { speed = 30 } }
			dig_5 = { set_variable = { speed = 35 } }
			dig_6 = { set_variable = { speed = 40 } }
			dig_7 = { set_variable = { speed = 45 } }
			dig_8 = { set_variable = { speed = 50 } }
			dig_9 = { set_variable = { speed = 55 } }
			dig_10 = { set_variable = { speed = 60 } }
		}
		set_variable = { globalCost = 0 }
		set_variable = { globalTime = 0 }
		set_variable = { localCost = 0 }
		set_variable = { localTime = 0 }
		set_variable = { testCost = 0 }
		set_variable = { testTime = 0 }
		set_variable = { Cost = 0 }
		set_variable = { Time = 0 }

		if = {
			limit = { has_province_modifier = easy_rock }
			multiply_variable = { speed = 0.8 }
		}
		if = {
			limit = { has_province_modifier = orc_hold_raider }
			multiply_variable = { speed = 1.2 }
		}
		if = {
			limit = { has_province_modifier = orc_hold_arena }
			multiply_variable = { speed = 1.2 }
		}
		if = {
			limit = { has_province_modifier = orc_hold_barrack }
			multiply_variable = { speed = 1.2 }
		}
		
		if = {
			limit = { has_terrain = dwarven_hold continent = serpentspine }
			multiply_variable = { speed = 0.8 }
		}
		if = {
			limit = { province_id = 4119 }
			multiply_variable = { speed = 0.9 }
		}
		if = {
			limit = { province_id = 4311 }
			multiply_variable = { speed = 0.95 }
		}
		if = {
			limit = { owner = { has_country_flag = dig_through } }
			multiply_variable = { speed = 0.8 }
		}
		if = {
			limit = { owner = { has_country_flag = remnant_dig } }
			multiply_variable = { speed = 0.9 }
		}
		if = {
			limit = { owner = { has_country_flag = not_dig_through } }
			multiply_variable = { speed = 1.2 }
		}
		if = {
			limit = { owner = { has_country_modifier = how_to_dig } }
			multiply_variable = { speed = 0.9 }
		}
		if = {
			limit = { owner = { has_country_modifier = dadv_digging_expert } }
			multiply_variable = { speed = 0.9 }
		}
		if = {
			limit = { owner = { NOT = { has_country_modifier = dwarven_administration } } }
			multiply_variable = { speed = 1.5 }
		}
		if = {
			limit = { owner = { has_age_ability = ab_dwarven_reclamation } }
			multiply_variable = { speed = 0.8 }
		}
		if = {
			limit = { check_variable = { speed = 80 } }
			set_variable = { speed = 80 }
		}
		if = {
			limit = { NOT = { check_variable = { speed = 10 } } }
			set_variable = { speed = 10 }
		}
		multiply_variable = { speed = 0.001 }
		multiply_variable = { speed = 1000 }#Final Cost in Ducats
		export_to_variable = {
			which = globalCost
			value = modifier:build_cost
			who = PREV
		}
		export_to_variable = {
			which = globalTime
			value = modifier:build_time
			who = PREV
		}
		export_to_variable = {
			which = localCost
			value = modifier:local_build_cost
		}
		export_to_variable = {
			which = localTime
			value = modifier:local_build_time
		}
		change_variable = {
			which = localCost
			which = globalCost
		}
		change_variable = {
			which = localTime
			which = globalTime
		}
		
		change_variable = { Cost = 1 }
		change_variable = { Time = 1 }
		change_variable = { which = Cost which = localCost }
		change_variable = { which = Time which = localTime }
		
		set_variable = { which = finalCost which = speed }
		multiply_variable = { which = finalCost which = finalCost }
		multiply_variable = { which = finalCost which = Cost }
		multiply_variable = { finalCost = 0.001 }
		multiply_variable = { finalCost = 1000 }#Final Cost in Ducats
		
		set_variable = { which = finalTime which = speed }
		multiply_variable = { which = finalTime which = Time } #Final Time in Years
	}
}

binary_ad1 = {
	if = {
		limit = {
			check_variable = {
				which = $variable$
				value = $value$
			}
		}
		owner = {
			add_treasury = -$value$
		}
		
		subtract_variable = {
			which = $variable$
			value = $value$
		}
	}
}

dig_rebate = { #reddit.com/r/eu4/comments/dy7lyv
	set_variable = {
		which = temp
		which = finalCost
	}
	divide_variable = {
		temp = 2
	}
	
	binary_ad1 = { variable = temp	value = 4096 }
	binary_ad1 = { variable = temp	value = 2048 }
	binary_ad1 = { variable = temp	value = 1024 }
	binary_ad1 = { variable = temp	value = 512	 }
	binary_ad1 = { variable = temp	value = 256	 }
	binary_ad1 = { variable = temp	value = 128	 }
	binary_ad1 = { variable = temp	value = 64	 }
	binary_ad1 = { variable = temp	value = 32	 }
	binary_ad1 = { variable = temp	value = 16	 }
	binary_ad1 = { variable = temp	value = 8	 }
	binary_ad1 = { variable = temp	value = 4	 }
	binary_ad1 = { variable = temp	value = 2	 }
	binary_ad1 = { variable = temp	value = 1	 }
}

start_digging_deeper = {
	hidden_effect = { cancel_construction = yes }
	custom_tooltip = cost_capital_dig_tooltip
	hidden_effect = {
			 if = { limit = { check_variable = { speed =	80	} } add_building_construction = { building = digging_deeper speed =	160	cost =	6400	} }
		else_if = { limit = { check_variable = { speed =	79	} } add_building_construction = { building = digging_deeper speed =	158	cost =	6241	} }
		else_if = { limit = { check_variable = { speed =	78	} } add_building_construction = { building = digging_deeper speed =	156	cost =	6084	} }
		else_if = { limit = { check_variable = { speed =	77	} } add_building_construction = { building = digging_deeper speed =	154	cost =	5929	} }
		else_if = { limit = { check_variable = { speed =	76	} } add_building_construction = { building = digging_deeper speed =	152	cost =	5776	} }
		else_if = { limit = { check_variable = { speed =	75	} } add_building_construction = { building = digging_deeper speed =	150	cost =	5625	} }
		else_if = { limit = { check_variable = { speed =	74	} } add_building_construction = { building = digging_deeper speed =	148	cost =	5476	} }
		else_if = { limit = { check_variable = { speed =	73	} } add_building_construction = { building = digging_deeper speed =	146	cost =	5329	} }
		else_if = { limit = { check_variable = { speed =	72	} } add_building_construction = { building = digging_deeper speed =	144	cost =	5184	} }
		else_if = { limit = { check_variable = { speed =	71	} } add_building_construction = { building = digging_deeper speed =	142	cost =	5041	} }
		else_if = { limit = { check_variable = { speed =	70	} } add_building_construction = { building = digging_deeper speed =	140	cost =	4900	} }
		else_if = { limit = { check_variable = { speed =	69	} } add_building_construction = { building = digging_deeper speed =	138	cost =	4761	} }
		else_if = { limit = { check_variable = { speed =	68	} } add_building_construction = { building = digging_deeper speed =	136	cost =	4624	} }
		else_if = { limit = { check_variable = { speed =	67	} } add_building_construction = { building = digging_deeper speed =	134	cost =	4489	} }
		else_if = { limit = { check_variable = { speed =	66	} } add_building_construction = { building = digging_deeper speed =	132	cost =	4356	} }
		else_if = { limit = { check_variable = { speed =	65	} } add_building_construction = { building = digging_deeper speed =	130	cost =	4225	} }
		else_if = { limit = { check_variable = { speed =	64	} } add_building_construction = { building = digging_deeper speed =	128	cost =	4096	} }
		else_if = { limit = { check_variable = { speed =	63	} } add_building_construction = { building = digging_deeper speed =	126	cost =	3969	} }
		else_if = { limit = { check_variable = { speed =	62	} } add_building_construction = { building = digging_deeper speed =	124	cost =	3844	} }
		else_if = { limit = { check_variable = { speed =	61	} } add_building_construction = { building = digging_deeper speed =	122	cost =	3721	} }
		else_if = { limit = { check_variable = { speed =	60	} } add_building_construction = { building = digging_deeper speed =	120	cost =	3600	} }
		else_if = { limit = { check_variable = { speed =	59	} } add_building_construction = { building = digging_deeper speed =	118	cost =	3481	} }
		else_if = { limit = { check_variable = { speed =	58	} } add_building_construction = { building = digging_deeper speed =	116	cost =	3364	} }
		else_if = { limit = { check_variable = { speed =	57	} } add_building_construction = { building = digging_deeper speed =	114	cost =	3249	} }
		else_if = { limit = { check_variable = { speed =	56	} } add_building_construction = { building = digging_deeper speed =	112	cost =	3136	} }
		else_if = { limit = { check_variable = { speed =	55	} } add_building_construction = { building = digging_deeper speed =	110	cost =	3025	} }
		else_if = { limit = { check_variable = { speed =	54	} } add_building_construction = { building = digging_deeper speed =	108	cost =	2916	} }
		else_if = { limit = { check_variable = { speed =	53	} } add_building_construction = { building = digging_deeper speed =	106	cost =	2809	} }
		else_if = { limit = { check_variable = { speed =	52	} } add_building_construction = { building = digging_deeper speed =	104	cost =	2704	} }
		else_if = { limit = { check_variable = { speed =	51	} } add_building_construction = { building = digging_deeper speed =	102	cost =	2601	} }
		else_if = { limit = { check_variable = { speed =	50	} } add_building_construction = { building = digging_deeper speed =	100	cost =	2500	} }
		else_if = { limit = { check_variable = { speed =	49	} } add_building_construction = { building = digging_deeper speed =	98	cost =	2401	} }
		else_if = { limit = { check_variable = { speed =	48	} } add_building_construction = { building = digging_deeper speed =	96	cost =	2304	} }
		else_if = { limit = { check_variable = { speed =	47	} } add_building_construction = { building = digging_deeper speed =	94	cost =	2209	} }
		else_if = { limit = { check_variable = { speed =	46	} } add_building_construction = { building = digging_deeper speed =	92	cost =	2116	} }
		else_if = { limit = { check_variable = { speed =	45	} } add_building_construction = { building = digging_deeper speed =	90	cost =	2025	} }
		else_if = { limit = { check_variable = { speed =	44	} } add_building_construction = { building = digging_deeper speed =	88	cost =	1936	} }
		else_if = { limit = { check_variable = { speed =	43	} } add_building_construction = { building = digging_deeper speed =	86	cost =	1849	} }
		else_if = { limit = { check_variable = { speed =	42	} } add_building_construction = { building = digging_deeper speed =	84	cost =	1764	} }
		else_if = { limit = { check_variable = { speed =	41	} } add_building_construction = { building = digging_deeper speed =	82	cost =	1681	} }
		else_if = { limit = { check_variable = { speed =	40	} } add_building_construction = { building = digging_deeper speed =	80	cost =	1600	} }
		else_if = { limit = { check_variable = { speed =	39	} } add_building_construction = { building = digging_deeper speed =	78	cost =	1521	} }
		else_if = { limit = { check_variable = { speed =	38	} } add_building_construction = { building = digging_deeper speed =	76	cost =	1444	} }
		else_if = { limit = { check_variable = { speed =	37	} } add_building_construction = { building = digging_deeper speed =	74	cost =	1369	} }
		else_if = { limit = { check_variable = { speed =	36	} } add_building_construction = { building = digging_deeper speed =	72	cost =	1296	} }
		else_if = { limit = { check_variable = { speed =	35	} } add_building_construction = { building = digging_deeper speed =	70	cost =	1225	} }
		else_if = { limit = { check_variable = { speed =	34	} } add_building_construction = { building = digging_deeper speed =	68	cost =	1156	} }
		else_if = { limit = { check_variable = { speed =	33	} } add_building_construction = { building = digging_deeper speed =	66	cost =	1089	} }
		else_if = { limit = { check_variable = { speed =	32	} } add_building_construction = { building = digging_deeper speed =	64	cost =	1024	} }
		else_if = { limit = { check_variable = { speed =	31	} } add_building_construction = { building = digging_deeper speed =	62	cost =	961 	} }
		else_if = { limit = { check_variable = { speed =	30	} } add_building_construction = { building = digging_deeper speed =	60	cost =	900 	} }
		else_if = { limit = { check_variable = { speed =	29	} } add_building_construction = { building = digging_deeper speed =	58	cost =	841 	} }
		else_if = { limit = { check_variable = { speed =	28	} } add_building_construction = { building = digging_deeper speed =	56	cost =	784 	} }
		else_if = { limit = { check_variable = { speed =	27	} } add_building_construction = { building = digging_deeper speed =	54	cost =	729 	} }
		else_if = { limit = { check_variable = { speed =	26	} } add_building_construction = { building = digging_deeper speed =	52	cost =	676 	} }
		else_if = { limit = { check_variable = { speed =	25	} } add_building_construction = { building = digging_deeper speed =	50	cost =	625 	} }
		else_if = { limit = { check_variable = { speed =	24	} } add_building_construction = { building = digging_deeper speed =	48	cost =	576 	} }
		else_if = { limit = { check_variable = { speed =	23	} } add_building_construction = { building = digging_deeper speed =	46	cost =	529 	} }
		else_if = { limit = { check_variable = { speed =	22	} } add_building_construction = { building = digging_deeper speed =	44	cost =	484 	} }
		else_if = { limit = { check_variable = { speed =	21	} } add_building_construction = { building = digging_deeper speed =	42	cost =	441 	} }
		else_if = { limit = { check_variable = { speed =	20	} } add_building_construction = { building = digging_deeper speed =	40	cost =	400 	} }
		else_if = { limit = { check_variable = { speed =	19	} } add_building_construction = { building = digging_deeper speed =	38	cost =	361 	} }
		else_if = { limit = { check_variable = { speed =	18	} } add_building_construction = { building = digging_deeper speed =	36	cost =	324 	} }
		else_if = { limit = { check_variable = { speed =	17	} } add_building_construction = { building = digging_deeper speed =	34	cost =	289 	} }
		else_if = { limit = { check_variable = { speed =	16	} } add_building_construction = { building = digging_deeper speed =	32	cost =	256 	} }
		else_if = { limit = { check_variable = { speed =	15	} } add_building_construction = { building = digging_deeper speed =	30	cost =	225 	} }
		else_if = { limit = { check_variable = { speed =	14	} } add_building_construction = { building = digging_deeper speed =	28	cost =	196 	} }
		else_if = { limit = { check_variable = { speed =	13	} } add_building_construction = { building = digging_deeper speed =	26	cost =	169 	} }
		else_if = { limit = { check_variable = { speed =	12	} } add_building_construction = { building = digging_deeper speed =	24	cost =	144 	} }
		else_if = { limit = { check_variable = { speed =	11	} } add_building_construction = { building = digging_deeper speed =	22	cost =	121 	} }
		else	= {													add_building_construction = { building = digging_deeper speed =	20	cost =	100 	} }
		
		set_variable = { cons_prog = 0.5 }
		
		random_list = {
			5 = { set_province_flag = strike_1 }
			5 = { set_province_flag = strike_2 }
			5 = { set_province_flag = strike_3 }
			5 = { set_province_flag = strike_4 }
			5 = { set_province_flag = strike_5 }
			5 = { set_province_flag = strike_6 }
			5 = { set_province_flag = strike_7 }
			5 = { set_province_flag = strike_8 }
			5 = { set_province_flag = strike_9 }
			5 = { set_province_flag = strike_10 }
			5 = { set_province_flag = strike_11 }
			5 = { set_province_flag = strike_12 }
			5 = { set_province_flag = strike_13 }
			5 = { set_province_flag = strike_14 }
			5 = { set_province_flag = strike_15 }
			5 = { set_province_flag = strike_16 }
			5 = { set_province_flag = strike_17 }
			5 = { set_province_flag = strike_18 }
			5 = { set_province_flag = strike_19 }
			5 = { set_province_flag = strike_20 }
		}
		
		random_list = {
			5 = { set_province_flag = swear_1 }
			5 = { set_province_flag = swear_2 }
			5 = { set_province_flag = swear_3 }
			5 = { set_province_flag = swear_4 }
			5 = { set_province_flag = swear_5 }
			5 = { set_province_flag = swear_6 }
			5 = { set_province_flag = swear_7 }
			5 = { set_province_flag = swear_8 }
			5 = { set_province_flag = swear_9 }
			5 = { set_province_flag = swear_10 }
			5 = { set_province_flag = swear_11 }
			5 = { set_province_flag = swear_12 }
			5 = { set_province_flag = swear_13 }
			5 = { set_province_flag = swear_14 }
			5 = { set_province_flag = swear_15 }
			5 = { set_province_flag = swear_16 }
			5 = { set_province_flag = swear_17 }
			5 = { set_province_flag = swear_18 }
			5 = { set_province_flag = swear_19 }
			5 = { set_province_flag = swear_20 }
		}
	}
}

upgrade_hold_capital = {
	trigger_switch = {
		on_trigger = has_province_modifier
		
		dig_1 = { remove_province_modifier = dig_1 add_permanent_province_modifier = { name = dig_2 duration = -1 } }
		dig_2 = { remove_province_modifier = dig_2 add_permanent_province_modifier = { name = dig_3 duration = -1 } }
		dig_3 = { remove_province_modifier = dig_3 add_permanent_province_modifier = { name = dig_4 duration = -1 } }
		dig_4 = { remove_province_modifier = dig_4 add_permanent_province_modifier = { name = dig_5 duration = -1 } }
		dig_5 = { remove_province_modifier = dig_5 add_permanent_province_modifier = { name = dig_6 duration = -1 } }
		dig_6 = { remove_province_modifier = dig_6 add_permanent_province_modifier = { name = dig_7 duration = -1 } }
		dig_7 = { remove_province_modifier = dig_7 add_permanent_province_modifier = { name = dig_8 duration = -1 } }
		dig_8 = { remove_province_modifier = dig_8 add_permanent_province_modifier = { name = dig_9 duration = -1 } }
		dig_9 = { remove_province_modifier = dig_9 add_permanent_province_modifier = { name = dig_10 duration = -1 } }
		dig_10 = { remove_province_modifier = dig_10 add_permanent_province_modifier = { name = dig_11 duration = -1 } }
	}
	hidden_effect = { 
		owner = {
			clr_country_flag = is_digging
			clr_country_flag = dig_prod
			clr_country_flag = dig_manpower
			clr_country_flag = dig_culture
			clr_country_flag = dig_explosive
			remove_country_modifier = dig_prod
			remove_country_modifier = dig_manpower
			remove_country_modifier = dig_explosive
		}
	}
}

define_hold_that_can_dig = {
	random_owned_province = {
		limit = { can_upgrade_hold = yes NOT = { has_province_flag = hold_@ROOT } }
		set_province_flag = option_hold_1_@ROOT
		set_province_flag = hold_@ROOT
		save_event_target_as = hold1
		setup_digging_deeper_non_capital = yes
	}
	random_owned_province = {
		limit = { can_upgrade_hold = yes NOT = { has_province_flag = hold_@ROOT } }
		set_province_flag = option_hold_2_@ROOT
		set_province_flag = hold_@ROOT
		save_event_target_as = hold2
		setup_digging_deeper_non_capital = yes
	}
	random_owned_province = {
		limit = { can_upgrade_hold = yes NOT = { has_province_flag = hold_@ROOT } }
		set_province_flag = option_hold_3_@ROOT
		set_province_flag = hold_@ROOT
		save_event_target_as = hold3
		setup_digging_deeper_non_capital = yes
	}
	random_owned_province = {
		limit = { can_upgrade_hold = yes NOT = { has_province_flag = hold_@ROOT } }
		set_province_flag = option_hold_4_@ROOT
		set_province_flag = hold_@ROOT
		save_event_target_as = hold4
		setup_digging_deeper_non_capital = yes
	}
	random_owned_province = {
		limit = { can_upgrade_hold = yes NOT = { has_province_flag = hold_@ROOT } }
		set_province_flag = option_hold_5_@ROOT
		set_province_flag = hold_@ROOT
		save_event_target_as = hold5
		setup_digging_deeper_non_capital = yes
	}
	random_owned_province = {
		limit = { can_upgrade_hold = yes NOT = { has_province_flag = hold_@ROOT } }
		set_province_flag = option_hold_6_@ROOT
		set_province_flag = hold_@ROOT
		save_event_target_as = hold6
		setup_digging_deeper_non_capital = yes
	}
	random_owned_province = {
		limit = { can_upgrade_hold = yes NOT = { has_province_flag = hold_@ROOT } }
		set_province_flag = option_hold_7_@ROOT
		set_province_flag = hold_@ROOT
		save_event_target_as = hold7
		setup_digging_deeper_non_capital = yes
	}
	random_owned_province = {
		limit = { can_upgrade_hold = yes NOT = { has_province_flag = hold_@ROOT } }
		set_province_flag = option_hold_8_@ROOT
		set_province_flag = hold_@ROOT
		save_event_target_as = hold8
		setup_digging_deeper_non_capital = yes
	}
	random_owned_province = {
		limit = { can_upgrade_hold = yes NOT = { has_province_flag = hold_@ROOT } }
		set_province_flag = option_hold_9_@ROOT
		set_province_flag = hold_@ROOT
		save_event_target_as = hold9
		setup_digging_deeper_non_capital = yes
	}
	random_owned_province = {
		limit = { can_upgrade_hold = yes NOT = { has_province_flag = hold_@ROOT } }
		set_province_flag = option_hold_10_@ROOT
		set_province_flag = hold_@ROOT
		save_event_target_as = hold10
		setup_digging_deeper_non_capital = yes
	}
	random_owned_province = {
		limit = { can_upgrade_hold = yes NOT = { has_province_flag = hold_@ROOT } }
		set_province_flag = option_hold_11_@ROOT
		set_province_flag = hold_@ROOT
		save_event_target_as = hold11
		setup_digging_deeper_non_capital = yes
	}
	random_owned_province = {
		limit = { can_upgrade_hold = yes NOT = { has_province_flag = hold_@ROOT } }
		set_province_flag = option_hold_12_@ROOT
		set_province_flag = hold_@ROOT
		save_event_target_as = hold12
		setup_digging_deeper_non_capital = yes
	}
	random_owned_province = {
		limit = { can_upgrade_hold = yes NOT = { has_province_flag = hold_@ROOT } }
		set_province_flag = option_hold_13_@ROOT
		set_province_flag = hold_@ROOT
		save_event_target_as = hold13
		setup_digging_deeper_non_capital = yes
	}
	random_owned_province = {
		limit = { can_upgrade_hold = yes NOT = { has_province_flag = hold_@ROOT } }
		set_province_flag = option_hold_14_@ROOT
		set_province_flag = hold_@ROOT
		save_event_target_as = hold14
		setup_digging_deeper_non_capital = yes
	}
	random_owned_province = {
		limit = { can_upgrade_hold = yes NOT = { has_province_flag = hold_@ROOT } }
		set_province_flag = option_hold_15_@ROOT
		set_province_flag = hold_@ROOT
		save_event_target_as = hold15
		setup_digging_deeper_non_capital = yes
	}
	random_owned_province = {
		limit = { can_upgrade_hold = yes NOT = { has_province_flag = hold_@ROOT } }
		set_province_flag = option_hold_16_@ROOT
		set_province_flag = hold_@ROOT
		save_event_target_as = hold16
		setup_digging_deeper_non_capital = yes
	}
	random_owned_province = {
		limit = { can_upgrade_hold = yes NOT = { has_province_flag = hold_@ROOT } }
		set_province_flag = option_hold_17_@ROOT
		set_province_flag = hold_@ROOT
		save_event_target_as = hold17
		setup_digging_deeper_non_capital = yes
	}
	random_owned_province = {
		limit = { can_upgrade_hold = yes NOT = { has_province_flag = hold_@ROOT } }
		set_province_flag = option_hold_18_@ROOT
		set_province_flag = hold_@ROOT
		save_event_target_as = hold18
		setup_digging_deeper_non_capital = yes
	}
	random_owned_province = {
		limit = { can_upgrade_hold = yes NOT = { has_province_flag = hold_@ROOT } }
		set_province_flag = option_hold_19_@ROOT
		set_province_flag = hold_@ROOT
		save_event_target_as = hold19
		setup_digging_deeper_non_capital = yes
	}
	random_owned_province = {
		limit = { can_upgrade_hold = yes NOT = { has_province_flag = hold_@ROOT } }
		set_province_flag = option_hold_20_@ROOT
		set_province_flag = hold_@ROOT
		save_event_target_as = hold20
		setup_digging_deeper_non_capital = yes
	}
	random_owned_province = {
		limit = { can_upgrade_hold = yes NOT = { has_province_flag = hold_@ROOT } }
		set_province_flag = option_hold_21_@ROOT
		set_province_flag = hold_@ROOT
		save_event_target_as = hold21
		setup_digging_deeper_non_capital = yes
	}
	random_owned_province = {
		limit = { can_upgrade_hold = yes NOT = { has_province_flag = hold_@ROOT } }
		set_province_flag = option_hold_22_@ROOT
		set_province_flag = hold_@ROOT
		save_event_target_as = hold22
		setup_digging_deeper_non_capital = yes
	}
	random_owned_province = {
		limit = { can_upgrade_hold = yes NOT = { has_province_flag = hold_@ROOT } }
		set_province_flag = option_hold_23_@ROOT
		set_province_flag = hold_@ROOT
		save_event_target_as = hold23
		setup_digging_deeper_non_capital = yes
	}
	random_owned_province = {
		limit = { can_upgrade_hold = yes NOT = { has_province_flag = hold_@ROOT } }
		set_province_flag = option_hold_24_@ROOT
		set_province_flag = hold_@ROOT
		save_event_target_as = hold24
		setup_digging_deeper_non_capital = yes
	}
	random_owned_province = {
		limit = { can_upgrade_hold = yes NOT = { has_province_flag = hold_@ROOT } }
		set_province_flag = option_hold_25_@ROOT
		set_province_flag = hold_@ROOT
		save_event_target_as = hold25
		setup_digging_deeper_non_capital = yes
	}
	random_owned_province = {
		limit = { can_upgrade_hold = yes NOT = { has_province_flag = hold_@ROOT } }
		set_province_flag = option_hold_26_@ROOT
		set_province_flag = hold_@ROOT
		save_event_target_as = hold26
		setup_digging_deeper_non_capital = yes
	}
	random_owned_province = {
		limit = { can_upgrade_hold = yes NOT = { has_province_flag = hold_@ROOT } }
		set_province_flag = option_hold_27_@ROOT
		set_province_flag = hold_@ROOT
		save_event_target_as = hold27
		setup_digging_deeper_non_capital = yes
	}
	random_owned_province = {
		limit = { can_upgrade_hold = yes NOT = { has_province_flag = hold_@ROOT } }
		set_province_flag = option_hold_28_@ROOT
		set_province_flag = hold_@ROOT
		save_event_target_as = hold28
		setup_digging_deeper_non_capital = yes
	}
	random_owned_province = {
		limit = { can_upgrade_hold = yes NOT = { has_province_flag = hold_@ROOT } }
		set_province_flag = option_hold_29_@ROOT
		set_province_flag = hold_@ROOT
		save_event_target_as = hold29
		setup_digging_deeper_non_capital = yes
	}

}

setup_digging_deeper_non_capital = {
	hidden_effect = {
		set_variable = { globalCost = 0 }
		set_variable = { globalTime = 0 }
		set_variable = { localCost = 0 }
		set_variable = { localTime = 0 }
		set_variable = { testCost = 0 }
		set_variable = { testTime = 0 }
		set_variable = { Cost = 0 }
		set_variable = { Time = 0 }
		trigger_switch = {
			on_trigger = has_province_modifier
			
			dig_1 = { set_variable = { speed = 20 } }
			dig_2 = { set_variable = { speed = 20 } }
			dig_3 = { set_variable = { speed = 30 } }
			dig_4 = { set_variable = { speed = 40 } }
			dig_5 = { set_variable = { speed = 50 } }
			dig_6 = { set_variable = { speed = 60 } }
			dig_7 = { set_variable = { speed = 70 } }
			dig_8 = { set_variable = { speed = 80 } }
			dig_9 = { set_variable = { speed = 80 } }
			dig_10 = { set_variable = { speed = 90 } }
		}
		if = {
			limit = { has_province_modifier = easy_rock }
			multiply_variable = { speed = 0.8 }
		}
		if = {
			limit = { has_province_modifier = orc_hold_raider }
			multiply_variable = { speed = 1.2 }
		}
		if = {
			limit = { has_province_modifier = orc_hold_arena }
			multiply_variable = { speed = 1.2 }
		}
		if = {
			limit = { has_province_modifier = orc_hold_barrack }
			multiply_variable = { speed = 1.2 }
		}
		if = {
			limit = { owner = { has_country_flag = dig_through } }
			multiply_variable = { speed = 0.8 }
		}
		if = {
			limit = { 676 = { has_province_modifier = the_harpylen_dam owned_by = owner } }
			multiply_variable = { speed = 0.8 }
		}
		if = {
			limit = { owner = { tag = I24 } } #Aul-Dwarov
			multiply_variable = { speed = 0.8 }
		}
		if = {
			limit = { owner = { has_age_ability = ab_dwarven_reclamation } }
			multiply_variable = { speed = 0.8 }
		}
		
		if = {
			limit = { check_variable = { speed = 90 } }
			set_variable = { speed = 90 }
		}
		if = {
			limit = { NOT = { check_variable = { speed = 10 } } }
			set_variable = { speed = 10 }
		}
		multiply_variable = { speed = 0.001 }
		multiply_variable = { speed = 1000 }
		export_to_variable = {
			which = globalCost
			value = modifier:build_cost
			who = PREV
		}
		export_to_variable = {
			which = globalTime
			value = modifier:build_time
			who = PREV
		}
		export_to_variable = {
			which = localCost
			value = modifier:local_build_cost
		}
		export_to_variable = {
			which = localTime
			value = modifier:local_build_time
		}
		change_variable = {
			which = localCost
			which = globalCost
		}
		change_variable = {
			which = localTime
			which = globalTime
		}
		
		change_variable = { Cost = 1 }
		change_variable = { Time = 1 }
		change_variable = { which = Cost which = localCost }
		change_variable = { which = Time which = localTime }
		
		set_variable = { finalCost = 1.5 }
		multiply_variable = { which = finalCost which = speed }
		multiply_variable = { which = finalCost which = speed }
		multiply_variable = { which = finalCost which = Cost }
		multiply_variable = { finalCost = 0.001 }
		multiply_variable = { finalCost = 1000 }#Final Cost in Ducats
		
		set_variable = { which = finalTime which = speed }
		multiply_variable = { which = finalTime which = Time } #Final Time in Years
	}
}


start_digging_deeper_non_capital = {
	hidden_effect = { cancel_construction = yes }
	custom_tooltip = cost_capital_dig_tooltip
	hidden_effect = {
		if = { limit = { check_variable = { speed = 90 } } add_building_construction = { building = digging_deeper speed = 90 cost = 12150 } }
		else_if = { limit = { check_variable = { speed = 89 } } add_building_construction = { building = digging_deeper speed = 89 cost = 11882 } }
		else_if = { limit = { check_variable = { speed = 88 } } add_building_construction = { building = digging_deeper speed = 88 cost = 11616 } }
		else_if = { limit = { check_variable = { speed = 87 } } add_building_construction = { building = digging_deeper speed = 87 cost = 11354 } }
		else_if = { limit = { check_variable = { speed = 86 } } add_building_construction = { building = digging_deeper speed = 86 cost = 11094 } }
		else_if = { limit = { check_variable = { speed = 85 } } add_building_construction = { building = digging_deeper speed = 85 cost = 10838 } }
		else_if = { limit = { check_variable = { speed = 84 } } add_building_construction = { building = digging_deeper speed = 84 cost = 10584 } }
		else_if = { limit = { check_variable = { speed = 83 } } add_building_construction = { building = digging_deeper speed = 83 cost = 10334 } }
		else_if = { limit = { check_variable = { speed = 82 } } add_building_construction = { building = digging_deeper speed = 82 cost = 10086 } }
		else_if = { limit = { check_variable = { speed = 81 } } add_building_construction = { building = digging_deeper speed = 81 cost = 9842 } }
		else_if = { limit = { check_variable = { speed = 80 } } add_building_construction = { building = digging_deeper speed = 80 cost = 9600 } }
		else_if = { limit = { check_variable = { speed = 79 } } add_building_construction = { building = digging_deeper speed = 79 cost = 9362 } }
		else_if = { limit = { check_variable = { speed = 78 } } add_building_construction = { building = digging_deeper speed = 78 cost = 9126 } }
		else_if = { limit = { check_variable = { speed = 77 } } add_building_construction = { building = digging_deeper speed = 77 cost = 8894 } }
		else_if = { limit = { check_variable = { speed = 76 } } add_building_construction = { building = digging_deeper speed = 76 cost = 8664 } }
		else_if = { limit = { check_variable = { speed = 75 } } add_building_construction = { building = digging_deeper speed = 75 cost = 8438 } }
		else_if = { limit = { check_variable = { speed = 74 } } add_building_construction = { building = digging_deeper speed = 74 cost = 8214 } }
		else_if = { limit = { check_variable = { speed = 73 } } add_building_construction = { building = digging_deeper speed = 73 cost = 7994 } }
		else_if = { limit = { check_variable = { speed = 72 } } add_building_construction = { building = digging_deeper speed = 72 cost = 7776 } }
		else_if = { limit = { check_variable = { speed = 71 } } add_building_construction = { building = digging_deeper speed = 71 cost = 7562 } }
		else_if = { limit = { check_variable = { speed = 70 } } add_building_construction = { building = digging_deeper speed = 70 cost = 7350 } }
		else_if = { limit = { check_variable = { speed = 69 } } add_building_construction = { building = digging_deeper speed = 69 cost = 7142 } }
		else_if = { limit = { check_variable = { speed = 68 } } add_building_construction = { building = digging_deeper speed = 68 cost = 6936 } }
		else_if = { limit = { check_variable = { speed = 67 } } add_building_construction = { building = digging_deeper speed = 67 cost = 6734 } }
		else_if = { limit = { check_variable = { speed = 66 } } add_building_construction = { building = digging_deeper speed = 66 cost = 6534 } }
		else_if = { limit = { check_variable = { speed = 65 } } add_building_construction = { building = digging_deeper speed = 65 cost = 6338 } }
		else_if = { limit = { check_variable = { speed = 64 } } add_building_construction = { building = digging_deeper speed = 64 cost = 6144 } }
		else_if = { limit = { check_variable = { speed = 63 } } add_building_construction = { building = digging_deeper speed = 63 cost = 5954 } }
		else_if = { limit = { check_variable = { speed = 62 } } add_building_construction = { building = digging_deeper speed = 62 cost = 5766 } }
		else_if = { limit = { check_variable = { speed = 61 } } add_building_construction = { building = digging_deeper speed = 61 cost = 5582 } }
		else_if = { limit = { check_variable = { speed = 60 } } add_building_construction = { building = digging_deeper speed = 60 cost = 5400 } }
		else_if = { limit = { check_variable = { speed = 59 } } add_building_construction = { building = digging_deeper speed = 59 cost = 5222 } }
		else_if = { limit = { check_variable = { speed = 58 } } add_building_construction = { building = digging_deeper speed = 58 cost = 5046 } }
		else_if = { limit = { check_variable = { speed = 57 } } add_building_construction = { building = digging_deeper speed = 57 cost = 4874 } }
		else_if = { limit = { check_variable = { speed = 56 } } add_building_construction = { building = digging_deeper speed = 56 cost = 4704 } }
		else_if = { limit = { check_variable = { speed = 55 } } add_building_construction = { building = digging_deeper speed = 55 cost = 4538 } }
		else_if = { limit = { check_variable = { speed = 54 } } add_building_construction = { building = digging_deeper speed = 54 cost = 4374 } }
		else_if = { limit = { check_variable = { speed = 53 } } add_building_construction = { building = digging_deeper speed = 53 cost = 4214 } }
		else_if = { limit = { check_variable = { speed = 52 } } add_building_construction = { building = digging_deeper speed = 52 cost = 4056 } }
		else_if = { limit = { check_variable = { speed = 51 } } add_building_construction = { building = digging_deeper speed = 51 cost = 3902 } }
		else_if = { limit = { check_variable = { speed = 50 } } add_building_construction = { building = digging_deeper speed = 50 cost = 3750 } }
		else_if = { limit = { check_variable = { speed = 49 } } add_building_construction = { building = digging_deeper speed = 49 cost = 3602 } }
		else_if = { limit = { check_variable = { speed = 48 } } add_building_construction = { building = digging_deeper speed = 48 cost = 3456 } }
		else_if = { limit = { check_variable = { speed = 47 } } add_building_construction = { building = digging_deeper speed = 47 cost = 3314 } }
		else_if = { limit = { check_variable = { speed = 46 } } add_building_construction = { building = digging_deeper speed = 46 cost = 3174 } }
		else_if = { limit = { check_variable = { speed = 45 } } add_building_construction = { building = digging_deeper speed = 45 cost = 3038 } }
		else_if = { limit = { check_variable = { speed = 44 } } add_building_construction = { building = digging_deeper speed = 44 cost = 2904 } }
		else_if = { limit = { check_variable = { speed = 43 } } add_building_construction = { building = digging_deeper speed = 43 cost = 2774 } }
		else_if = { limit = { check_variable = { speed = 42 } } add_building_construction = { building = digging_deeper speed = 42 cost = 2646 } }
		else_if = { limit = { check_variable = { speed = 41 } } add_building_construction = { building = digging_deeper speed = 41 cost = 2522 } }
		else_if = { limit = { check_variable = { speed = 40 } } add_building_construction = { building = digging_deeper speed = 40 cost = 2400 } }
		else_if = { limit = { check_variable = { speed = 39 } } add_building_construction = { building = digging_deeper speed = 39 cost = 2282 } }
		else_if = { limit = { check_variable = { speed = 38 } } add_building_construction = { building = digging_deeper speed = 38 cost = 2166 } }
		else_if = { limit = { check_variable = { speed = 37 } } add_building_construction = { building = digging_deeper speed = 37 cost = 2054 } }
		else_if = { limit = { check_variable = { speed = 36 } } add_building_construction = { building = digging_deeper speed = 36 cost = 1944 } }
		else_if = { limit = { check_variable = { speed = 35 } } add_building_construction = { building = digging_deeper speed = 35 cost = 1838 } }
		else_if = { limit = { check_variable = { speed = 34 } } add_building_construction = { building = digging_deeper speed = 34 cost = 1734 } }
		else_if = { limit = { check_variable = { speed = 33 } } add_building_construction = { building = digging_deeper speed = 33 cost = 1634 } }
		else_if = { limit = { check_variable = { speed = 32 } } add_building_construction = { building = digging_deeper speed = 32 cost = 1536 } }
		else_if = { limit = { check_variable = { speed = 31 } } add_building_construction = { building = digging_deeper speed = 31 cost = 1442 } }
		else_if = { limit = { check_variable = { speed = 30 } } add_building_construction = { building = digging_deeper speed = 30 cost = 1350 } }
		else_if = { limit = { check_variable = { speed = 29 } } add_building_construction = { building = digging_deeper speed = 29 cost = 1262 } }
		else_if = { limit = { check_variable = { speed = 28 } } add_building_construction = { building = digging_deeper speed = 28 cost = 1176 } }
		else_if = { limit = { check_variable = { speed = 27 } } add_building_construction = { building = digging_deeper speed = 27 cost = 1094 } }
		else_if = { limit = { check_variable = { speed = 26 } } add_building_construction = { building = digging_deeper speed = 26 cost = 1014 } }
		else_if = { limit = { check_variable = { speed = 25 } } add_building_construction = { building = digging_deeper speed = 25 cost = 938 } }
		else_if = { limit = { check_variable = { speed = 24 } } add_building_construction = { building = digging_deeper speed = 24 cost = 864 } }
		else_if = { limit = { check_variable = { speed = 23 } } add_building_construction = { building = digging_deeper speed = 23 cost = 794 } }
		else_if = { limit = { check_variable = { speed = 22 } } add_building_construction = { building = digging_deeper speed = 22 cost = 726 } }
		else_if = { limit = { check_variable = { speed = 21 } } add_building_construction = { building = digging_deeper speed = 21 cost = 662 } }
		else_if = { limit = { check_variable = { speed = 20 } } add_building_construction = { building = digging_deeper speed = 20 cost = 600 } }
		else_if = { limit = { check_variable = { speed = 19 } } add_building_construction = { building = digging_deeper speed = 19 cost = 542 } }
		else_if = { limit = { check_variable = { speed = 18 } } add_building_construction = { building = digging_deeper speed = 18 cost = 486 } }
		else_if = { limit = { check_variable = { speed = 17 } } add_building_construction = { building = digging_deeper speed = 17 cost = 434 } }
		else_if = { limit = { check_variable = { speed = 16 } } add_building_construction = { building = digging_deeper speed = 16 cost = 384 } }
		else_if = { limit = { check_variable = { speed = 15 } } add_building_construction = { building = digging_deeper speed = 15 cost = 338 } }
		else_if = { limit = { check_variable = { speed = 14 } } add_building_construction = { building = digging_deeper speed = 14 cost = 294 } }
		else_if = { limit = { check_variable = { speed = 13 } } add_building_construction = { building = digging_deeper speed = 13 cost = 254 } }
		else_if = { limit = { check_variable = { speed = 12 } } add_building_construction = { building = digging_deeper speed = 12 cost = 216 } }
		else_if = { limit = { check_variable = { speed = 11 } } add_building_construction = { building = digging_deeper speed = 11 cost = 182 } }
		else = { add_building_construction = { building = digging_deeper speed = 10 cost = 150 } }
		random_list = {
			5 = { set_province_flag = strike_1 }
			5 = { set_province_flag = strike_2 }
			5 = { set_province_flag = strike_3 }
			5 = { set_province_flag = strike_4 }
			5 = { set_province_flag = strike_5 }
			5 = { set_province_flag = strike_6 }
			5 = { set_province_flag = strike_7 }
			5 = { set_province_flag = strike_8 }
			5 = { set_province_flag = strike_9 }
			5 = { set_province_flag = strike_10 }
			5 = { set_province_flag = strike_11 }
			5 = { set_province_flag = strike_12 }
			5 = { set_province_flag = strike_13 }
			5 = { set_province_flag = strike_14 }
			5 = { set_province_flag = strike_15 }
			5 = { set_province_flag = strike_16 }
			5 = { set_province_flag = strike_17 }
			5 = { set_province_flag = strike_18 }
			5 = { set_province_flag = strike_19 }
			5 = { set_province_flag = strike_20 }
		}
		
		random_list = {
			5 = { set_province_flag = swear_1 }
			5 = { set_province_flag = swear_2 }
			5 = { set_province_flag = swear_3 }
			5 = { set_province_flag = swear_4 }
			5 = { set_province_flag = swear_5 }
			5 = { set_province_flag = swear_6 }
			5 = { set_province_flag = swear_7 }
			5 = { set_province_flag = swear_8 }
			5 = { set_province_flag = swear_9 }
			5 = { set_province_flag = swear_10 }
			5 = { set_province_flag = swear_11 }
			5 = { set_province_flag = swear_12 }
			5 = { set_province_flag = swear_13 }
			5 = { set_province_flag = swear_14 }
			5 = { set_province_flag = swear_15 }
			5 = { set_province_flag = swear_16 }
			5 = { set_province_flag = swear_17 }
			5 = { set_province_flag = swear_18 }
			5 = { set_province_flag = swear_19 }
			5 = { set_province_flag = swear_20 }
		}
	}
}

clr_digging_menu = {
	every_owned_province = {
		limit = { has_province_flag = hold_@ROOT }
		clr_province_flag = option_hold_1_@ROOT
		clr_province_flag = option_hold_2_@ROOT
		clr_province_flag = option_hold_3_@ROOT
		clr_province_flag = option_hold_4_@ROOT
		clr_province_flag = option_hold_5_@ROOT
		clr_province_flag = option_hold_6_@ROOT
		clr_province_flag = option_hold_7_@ROOT
		clr_province_flag = option_hold_8_@ROOT
		clr_province_flag = option_hold_9_@ROOT
		clr_province_flag = option_hold_10_@ROOT
		clr_province_flag = option_hold_11_@ROOT
		clr_province_flag = option_hold_12_@ROOT
		clr_province_flag = option_hold_13_@ROOT
		clr_province_flag = option_hold_14_@ROOT
		clr_province_flag = option_hold_15_@ROOT
		clr_province_flag = option_hold_16_@ROOT
		clr_province_flag = option_hold_17_@ROOT
		clr_province_flag = option_hold_18_@ROOT
		clr_province_flag = option_hold_19_@ROOT
		clr_province_flag = option_hold_20_@ROOT
		clr_province_flag = option_hold_21_@ROOT
		clr_province_flag = option_hold_22_@ROOT
		clr_province_flag = option_hold_23_@ROOT
		clr_province_flag = option_hold_24_@ROOT
		clr_province_flag = option_hold_25_@ROOT
		clr_province_flag = option_hold_26_@ROOT
		clr_province_flag = option_hold_27_@ROOT
		clr_province_flag = option_hold_28_@ROOT
		clr_province_flag = option_hold_29_@ROOT
		clr_province_flag = hold_@ROOT
	}
	clr_country_flag = hold_operation_menu
}

upgrade_hold = {
	trigger_switch = {
		on_trigger = has_province_modifier
		
		dig_1 = { remove_province_modifier = dig_1 add_permanent_province_modifier = { name = dig_2 duration = -1 } }
		dig_2 = { remove_province_modifier = dig_2 add_permanent_province_modifier = { name = dig_3 duration = -1 } }
		dig_3 = { remove_province_modifier = dig_3 add_permanent_province_modifier = { name = dig_4 duration = -1 } }
		dig_4 = { remove_province_modifier = dig_4 add_permanent_province_modifier = { name = dig_5 duration = -1 } }
		dig_5 = { remove_province_modifier = dig_5 add_permanent_province_modifier = { name = dig_6 duration = -1 } }
		dig_6 = { remove_province_modifier = dig_6 add_permanent_province_modifier = { name = dig_7 duration = -1 } }
		dig_7 = { remove_province_modifier = dig_7 add_permanent_province_modifier = { name = dig_8 duration = -1 } }
		dig_8 = { remove_province_modifier = dig_8 add_permanent_province_modifier = { name = dig_9 duration = -1 } }
		dig_9 = { remove_province_modifier = dig_9 add_permanent_province_modifier = { name = dig_10 duration = -1 } }
		dig_10 = { remove_province_modifier = dig_10 add_permanent_province_modifier = { name = dig_11 duration = -1 } }
	}
}

clr_cavern_exploration = {
	hidden_effect = {
		clr_country_flag = cave_1 
		clr_country_flag = cave_2 
		clr_country_flag = cave_3 
		clr_country_flag = cave_4 
		clr_country_flag = cave_5 
		clr_country_flag = cave_6 
		clr_country_flag = cave_7 
		clr_country_flag = cave_8 
		clr_country_flag = cave_9 
		clr_country_flag = cave_10
		clr_country_flag = cave_11
		clr_country_flag = cave_12
		clr_country_flag = cave_13
		clr_country_flag = cave_14
		clr_country_flag = cave_15
		clr_country_flag = cave_16
		clr_country_flag = cave_17
		clr_country_flag = cave_18
		clr_country_flag = cave_19
		clr_country_flag = cave_20
		clr_country_flag = cave_21
		clr_country_flag = cave_22
		clr_country_flag = cave_23
		clr_country_flag = cave_24
		clr_country_flag = cave_25
		clr_country_flag = exploring_cavern
	}
}

amlharaz_hold_vote = {
	every_subject_country = {
		limit = { is_subject_of_type = amlharaz_hold }
		if = {
			limit = {
				OR = {
					AND = { has_country_flag = for_amlharaz I24 = { has_country_flag = enacted_amlharaz } }
					AND = { has_country_flag = against_amlharaz I24 = { has_country_flag = denied_amlharaz } }
				}
			}
			amlharaz_happy = yes
			clr_country_flag = for_amlharaz
		}
		else = {
			amlharaz_not_happy = yes
			clr_country_flag = against_amlharaz
		}
	}
}

amlharaz_not_happy = {
	trigger_switch = {
		on_trigger = has_country_modifier
		
		amlharaz_liberty_desire_1 = { remove_country_modifier = amlharaz_liberty_desire_1 add_country_modifier = { name = amlharaz_liberty_desire_0 duration = -1 } }
		amlharaz_liberty_desire_2 = { remove_country_modifier = amlharaz_liberty_desire_2 add_country_modifier = { name = amlharaz_liberty_desire_1 duration = -1 } }
		amlharaz_liberty_desire_3 = { remove_country_modifier = amlharaz_liberty_desire_3 add_country_modifier = { name = amlharaz_liberty_desire_2 duration = -1 } }
		amlharaz_liberty_desire_4 = { remove_country_modifier = amlharaz_liberty_desire_4 add_country_modifier = { name = amlharaz_liberty_desire_3 duration = -1 } }
		amlharaz_liberty_desire_5 = { remove_country_modifier = amlharaz_liberty_desire_5 add_country_modifier = { name = amlharaz_liberty_desire_4 duration = -1 } }
		amlharaz_liberty_desire_6 = { remove_country_modifier = amlharaz_liberty_desire_6 add_country_modifier = { name = amlharaz_liberty_desire_5 duration = -1 } }
		amlharaz_liberty_desire_7 = { remove_country_modifier = amlharaz_liberty_desire_7 add_country_modifier = { name = amlharaz_liberty_desire_6 duration = -1 } }
		amlharaz_liberty_desire_8 = { remove_country_modifier = amlharaz_liberty_desire_8 add_country_modifier = { name = amlharaz_liberty_desire_7 duration = -1 } }
		amlharaz_liberty_desire_9 = { remove_country_modifier = amlharaz_liberty_desire_9 add_country_modifier = { name = amlharaz_liberty_desire_8 duration = -1 } }
		amlharaz_liberty_desire_10 = { remove_country_modifier = amlharaz_liberty_desire_10 add_country_modifier = { name = amlharaz_liberty_desire_9 duration = -1 } }
		amlharaz_liberty_desire_11 = { remove_country_modifier = amlharaz_liberty_desire_11 add_country_modifier = { name = amlharaz_liberty_desire_10 duration = -1 } }
		amlharaz_liberty_desire_12 = { remove_country_modifier = amlharaz_liberty_desire_12 add_country_modifier = { name = amlharaz_liberty_desire_11 duration = -1 } }
		amlharaz_liberty_desire_13 = { remove_country_modifier = amlharaz_liberty_desire_13 add_country_modifier = { name = amlharaz_liberty_desire_12 duration = -1 } }
		amlharaz_liberty_desire_14 = { remove_country_modifier = amlharaz_liberty_desire_14 add_country_modifier = { name = amlharaz_liberty_desire_13 duration = -1 } }
		amlharaz_liberty_desire_15 = { remove_country_modifier = amlharaz_liberty_desire_15 add_country_modifier = { name = amlharaz_liberty_desire_14 duration = -1 } }
		amlharaz_liberty_desire_16 = { remove_country_modifier = amlharaz_liberty_desire_16 add_country_modifier = { name = amlharaz_liberty_desire_15 duration = -1 } }
		amlharaz_liberty_desire_17 = { remove_country_modifier = amlharaz_liberty_desire_17 add_country_modifier = { name = amlharaz_liberty_desire_16 duration = -1 } }
		amlharaz_liberty_desire_18 = { remove_country_modifier = amlharaz_liberty_desire_18 add_country_modifier = { name = amlharaz_liberty_desire_17 duration = -1 } }
		amlharaz_liberty_desire_19 = { remove_country_modifier = amlharaz_liberty_desire_19 add_country_modifier = { name = amlharaz_liberty_desire_18 duration = -1 } }
		amlharaz_liberty_desire_20 = { remove_country_modifier = amlharaz_liberty_desire_20 add_country_modifier = { name = amlharaz_liberty_desire_19 duration = -1 } }
	}
}

amlharaz_happy = {
	trigger_switch = {
		on_trigger = has_country_modifier
		
		amlharaz_liberty_desire_19 = { remove_country_modifier = amlharaz_liberty_desire_19 add_country_modifier = { name = amlharaz_liberty_desire_20 duration = -1 } }
		amlharaz_liberty_desire_18 = { remove_country_modifier = amlharaz_liberty_desire_18 add_country_modifier = { name = amlharaz_liberty_desire_19 duration = -1 } }
		amlharaz_liberty_desire_17 = { remove_country_modifier = amlharaz_liberty_desire_17 add_country_modifier = { name = amlharaz_liberty_desire_18 duration = -1 } }
		amlharaz_liberty_desire_16 = { remove_country_modifier = amlharaz_liberty_desire_16 add_country_modifier = { name = amlharaz_liberty_desire_17 duration = -1 } }
		amlharaz_liberty_desire_15 = { remove_country_modifier = amlharaz_liberty_desire_15 add_country_modifier = { name = amlharaz_liberty_desire_16 duration = -1 } }
		amlharaz_liberty_desire_14 = { remove_country_modifier = amlharaz_liberty_desire_14 add_country_modifier = { name = amlharaz_liberty_desire_15 duration = -1 } }
		amlharaz_liberty_desire_13 = { remove_country_modifier = amlharaz_liberty_desire_13 add_country_modifier = { name = amlharaz_liberty_desire_14 duration = -1 } }
		amlharaz_liberty_desire_12 = { remove_country_modifier = amlharaz_liberty_desire_12 add_country_modifier = { name = amlharaz_liberty_desire_13 duration = -1 } }
		amlharaz_liberty_desire_11 = { remove_country_modifier = amlharaz_liberty_desire_11 add_country_modifier = { name = amlharaz_liberty_desire_12 duration = -1 } }
		amlharaz_liberty_desire_10 = { remove_country_modifier = amlharaz_liberty_desire_10 add_country_modifier = { name = amlharaz_liberty_desire_11 duration = -1 } }
		amlharaz_liberty_desire_9 = { remove_country_modifier = amlharaz_liberty_desire_9 add_country_modifier = { name = amlharaz_liberty_desire_10 duration = -1 } }
		amlharaz_liberty_desire_8 = { remove_country_modifier = amlharaz_liberty_desire_8 add_country_modifier = { name = amlharaz_liberty_desire_9 duration = -1 } }
		amlharaz_liberty_desire_7 = { remove_country_modifier = amlharaz_liberty_desire_7 add_country_modifier = { name = amlharaz_liberty_desire_8 duration = -1 } }
		amlharaz_liberty_desire_6 = { remove_country_modifier = amlharaz_liberty_desire_6 add_country_modifier = { name = amlharaz_liberty_desire_7 duration = -1 } }
		amlharaz_liberty_desire_5 = { remove_country_modifier = amlharaz_liberty_desire_5 add_country_modifier = { name = amlharaz_liberty_desire_6 duration = -1 } }
		amlharaz_liberty_desire_4 = { remove_country_modifier = amlharaz_liberty_desire_4 add_country_modifier = { name = amlharaz_liberty_desire_5 duration = -1 } }
		amlharaz_liberty_desire_3 = { remove_country_modifier = amlharaz_liberty_desire_3 add_country_modifier = { name = amlharaz_liberty_desire_4 duration = -1 } }
		amlharaz_liberty_desire_2 = { remove_country_modifier = amlharaz_liberty_desire_2 add_country_modifier = { name = amlharaz_liberty_desire_3 duration = -1 } }
		amlharaz_liberty_desire_1 = { remove_country_modifier = amlharaz_liberty_desire_1 add_country_modifier = { name = amlharaz_liberty_desire_2 duration = -1 } }
		amlharaz_liberty_desire_0 = { remove_country_modifier = amlharaz_liberty_desire_0 add_country_modifier = { name = amlharaz_liberty_desire_1 duration = -1 } }
	}
}

save_yearly_income = { #Saves income for 0.5 1 1.5 2 3 5 7 9 years of income

	set_variable = { HalfYearOfIncome = 0}
	set_variable = { YearOfIncome = 0}
	set_variable = { OneAndHalfYearOfIncome = 0}
	set_variable = { 2YearOfIncome = 0}
	set_variable = { 3YearOfIncome = 0}
	set_variable = { 5YearOfIncome = 0}
	set_variable = { 7YearOfIncome = 0}
	set_variable = { 9YearOfIncome = 0}
	
	#Save yearly income at this point
	export_to_variable = {
		which = YearOfIncome
		value = years_of_income
		who = ROOT
	}
	
	
	#Do the same for other years of income, way easier than re-calculating it every time
	export_to_variable = {
		which = 2YearOfIncome
		value = years_of_income
		who = ROOT
	}
	
	#Turn it negative and slightly increase it to make up for the negative income modifiers for hoardcurse
	multiply_variable = {
		which = 2YearOfIncome
		value = 2
	}
	
	export_to_variable = {
		which = 3YearOfIncome
		value = years_of_income
		who = ROOT
	}
	
	#Turn it negative and slightly increase it to make up for the negative income modifiers for hoardcurse
	multiply_variable = {
		which = 3YearOfIncome
		value = 3
	}

	export_to_variable = {
		which = 5YearOfIncome
		value = years_of_income
		who = ROOT
	}

	#Turn it negative and slightly increase it to make up for the negative income modifiers for hoardcurse
	multiply_variable = {
		which = 5YearOfIncome
		value = 5
	}

	export_to_variable = {
		which = 7YearOfIncome
		value = years_of_income
		who = ROOT
	}

	#Turn it negative and slightly increase it to make up for the negative income modifiers for hoardcurse
	multiply_variable = {
		which = 7YearOfIncome
		value = 7
	}

	export_to_variable = {
		which = 9YearOfIncome
		value = years_of_income
		who = ROOT
	}

	#Turn it negative and slightly increase it to make up for the negative income modifiers for hoardcurse
	multiply_variable = {
		which = 9YearOfIncome
		value = 9
	}

	export_to_variable = {
		which = OneAndHalfYearOfIncome
		value = years_of_income
		who = ROOT
	}

	#Turn it negative and slightly increase it to make up for the negative income modifiers for hoardcurse
	multiply_variable = {
		which = OneAndHalfYearOfIncome
		value = 1.5
	}

	export_to_variable = {
		which = HalfYearOfIncome
		value = years_of_income
		who = ROOT
	}

	#Turn it negative and slightly increase it to make up for the negative income modifiers for hoardcurse
	divide_variable  = {
		which = HalfYearOfIncome
		value = 2
	}
}

set_province_historical_culture = {
	trigger_switch = {
		on_trigger = area
		amldihr_area = { add_core = I01  change_culture = kronium_dwarf }  
		krakdhum_area = {  add_core = I02  change_culture = quartz_dwarf }
		vazhatun_area = {  add_core = I03  change_culture = sapphire_dwarf }
		orlazam_area = {  add_core = I04  change_culture = ramsteel_dwarf }
		mithradhum_area = {  add_core = I05  change_culture = mithril_dwarf }
		railyard_area = {  add_core = I06  change_culture = dagrite_dwarf }
		khugdihr_area = {  add_core = I07  change_culture = agate_dwarf }
		orldhum_area = {  add_core = I08  change_culture = platinum_dwarf }
		stunad_kozenad_area = {  add_core = I09  change_culture = opal_dwarf }
		jorkad_junction_area = {  add_core = I10  change_culture = lead_dwarf }
		shazstundihr_area = {  add_core = I11  change_culture = marble_dwarf }
		orlghelovar_area = {  add_core = I12  change_culture = cobalt_dwarf }
		stunad_skomdihr_area = {  add_core = I13  change_culture = flint_dwarf }
		vazumbrog_area = {  add_core = I14  change_culture = titanium_dwarf }
		hehos_legacy_area = {  add_core = I15  change_culture = pyrite_dwarf }
		gor_burad_area = {  add_core = I16  change_culture = basalt_dwarf }
		ozumbrog_area = {  add_core = I17  change_culture = topaz_dwarf }
		grozumdihr_area = {  add_core = I18  change_culture = peridot_dwarf }
		ovdal_az_an_area = {  add_core = I19  change_culture = granite_dwarf }
		hul_az_krakazol_area = {  add_core = I20  change_culture = amethyst_dwarf }
		tuwad_area = {  add_core = I21  change_culture = emerald_dwarf }
		gronstunad_area = { add_core = I22  change_culture = jade_dwarf }
		dromak_area = {  add_core = I25  change_culture = malachite_dwarf }
		arg_ordstun_area = {  add_core = H76  change_culture = diamond_dwarf }
		ovdal_lodhum_area = {  add_core = H77  change_culture = garnet_dwarf }
		verkal_gulan_area = {  add_core = F47  change_culture = gold_dwarf }
		kanzad_area = {  add_core = H79  change_culture = amber_dwarf }
		seghdihr_area = {  add_core = H78  change_culture = citrine_dwarf }
	}
}

set_base_value = {
	set_variable = { #100% base cost
		which = $which$
		value = 1
	}

	export_to_variable = {
		variable_name = apowerCost
		value = modifier:all_power_cost
		who = owner
	}
	change_variable = { #power cost modifiers
		which = $which$
		which = apowerCost
	}

	export_to_variable = {
		variable_name = devCost
		value = modifier:development_cost
		who = owner
	}
	change_variable = { #country dev modifiers
		which = $which$
		which = devCost
	}

	export_to_variable = {
		variable_name = ldevCost
		value = modifier:local_development_cost
	}
	change_variable = { #province dev modifiers
		which = $which$
		which = ldevCost
	}

	if = { #dev efficiency from adm tech affects base cost by -10%
		limit = {
			owner = { adm_tech = 27 }
		}
		multiply_variable = {
			which = $which$
			value = 35
		}
	}
	else_if  = {
		limit = {
			owner = { adm_tech = 23 }
		}
		multiply_variable = {
			which = $which$
			value = 40
		}
	}
	else_if  = {
		limit = {
			owner = { adm_tech = 17 }
		}
		multiply_variable = {
			which = $which$
			value = 45
		}
	}
	else = {
		multiply_variable = {
			which = $which$
			value = 50
		}
	}
}
add_power = { #reddit.com/r/eu4/comments/dy7lyv
	set_variable = {
		which = temp
		which = provDevCost
	}

	binary_ad20 = { variable = temp	addcommand = $power$	valueAdd = 1024 	valueSub = -1024 }
	binary_ad20 = { variable = temp	addcommand = $power$	valueAdd = 512		valueSub = -512 }
	binary_ad20 = { variable = temp	addcommand = $power$	valueAdd = 256		valueSub = -256 }
	binary_ad20 = { variable = temp	addcommand = $power$	valueAdd = 128		valueSub = -128 }
	binary_ad20 = { variable = temp	addcommand = $power$	valueAdd = 64		valueSub = -64 }
	binary_ad20 = { variable = temp	addcommand = $power$	valueAdd = 32		valueSub = -32 }
	binary_ad20 = { variable = temp	addcommand = $power$	valueAdd = 16		valueSub = -16 }
	binary_ad20 = { variable = temp	addcommand = $power$	valueAdd = 8		valueSub = -8 }
	binary_ad20 = { variable = temp	addcommand = $power$	valueAdd = 4		valueSub = -4 }
	binary_ad20 = { variable = temp	addcommand = $power$	valueAdd = 2		valueSub = -2 }
	binary_ad20 = { variable = temp	addcommand = $power$	valueAdd = 1		valueSub = -1 }
	#log = dev_info.4
}

binary_ad20 = {
	if = {
		limit = {
			check_variable = {
				which = $variable$
				value = $valueAdd$
			}
		}
		owner = {
			add_$addcommand$_power = $valueSub$
		}

		subtract_variable = {
			which = $variable$
			value = $valueAdd$
		}
	}
}